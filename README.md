# YTPlayer 易听

一个基于 .NET Framework 的网易云音乐第三方桌面客户端，提供无障碍且简单流畅的音乐播放体验和高质量音频支持。

## 项目概述

本项目是一个使用 C# WinForms 开发的网易云音乐第三方客户端，通过网易云音乐的公开 API 提供音乐搜索、播放和管理功能。应用基于 BASS 音频库实现高质量音频播放，并采用智能缓存系统确保流畅的播放体验。

**技术栈：**
- .NET Framework 4.8 (C# 9.0)
- Windows Forms UI
- BASS Audio Library (bass.dll, bassflac.dll)
- Newtonsoft.Json
- QRCoder (二维码登录)

## 项目特色

### 🎵 高质量音频支持
- 支持多种音质等级：标准 (128kbps)、高品 (320kbps)、无损 (FLAC)、Hi-Res、臻品母带
- 根据会员等级自动选择最佳音质

### ⚡ 智能缓存系统
- 多音质音频块缓存管理系统，对不支持 http range 的网易云音乐 API 实现尽可能优秀的任意时间跳转能力。
- 优先级下载调度器，优先缓存播放位置附近的音频块
- 智能预加载下一曲，实现无缝播放

### 🎯 流畅播放体验
- 全异步操作，UI 始终保持响应
- 播放队列管理，支持随机播放和循环模式

### 🔐 完整登录系统
- 二维码扫码登录
- 短信验证码登录
- 设备指纹管理，模拟官方客户端行为
- 安全的会话状态持久化

## 构建方法

### 环境要求
- Windows 64 位操作系统
- .NET Framework 4.8
- PowerShell（用于运行构建脚本）

### Release 构建
```powershell
powershell -ExecutionPolicy Bypass -File .\Build.ps1
```
输出文件：`bin\Release\YTPlayer.exe`

### Debug 构建
```powershell
powershell -ExecutionPolicy Bypass -File .\Build-Debug.ps1
```
输出文件：`bin\Debug\YTPlayer.exe`

### 依赖安装
项目使用 NuGet 包管理器管理依赖。构建脚本会自动还原所需的包：
- Newtonsoft.Json
- QRCoder
- BrotliSharpLib

## 使用方法

### 首次使用

1. 运行构建脚本生成可执行文件
2. 运行 `YTPlayer.exe` 启动程序
3. 享受音乐吧

### 主要功能

#### 🔍 搜索音乐
- 在搜索框输入歌曲名、歌手名或专辑名
- 支持搜索歌曲、歌单、专辑和歌手
- 点击搜索结果即可播放

#### 📩 歌曲、歌单、专辑下载
- 支持下载歌曲、歌单、专辑
- **批量下载**，支持批量下载当前视图列表中的项目。
- **下载管理**，支持管理正在进行中和已完成的下载。

#### 🎼 播放控制
- **播放/暂停**：点击播放/暂停按钮、使用播放/控制菜单项或使用空格键
- **上一曲/下一曲**：使用播放/控制子菜单项或快捷键 F5 / F6
- **快退/快进**：拖动进度条或使用左右光标进行 5 秒快退/快进
- **任意时间跳转**：使用播放/控制子菜单项或快捷键 F12 打开跳转对话框，输入冒号`:`分隔的时间格式或百分比加百分号`%`进行对应位置的进度跳转。
- **音量调节**：使用音量滑块或快捷键 F7/F8 调整音量
- **播放模式**：支持顺序播放、列表循环、单曲循环、随机播放
- **歌词输出**：使用播放/控制子菜单项或快捷键 F11 来切换歌词的屏幕阅读器实时输出。

#### 📝 播放列表
- 基于列表视图的简单 UI 导航与浏览，使用 Backspace 后退到上一视图
- 基于列表视图的有序播放和歌曲插播

#### 🧑 用户登录
点击登录按钮，选择二维码登录或短信登录
登录成功后即可开始获取和浏览个性化数据、根据会员等级状态享受会员权益，聆听专属歌曲和音质

# 已知的问题，正在着手修复：
- 添加歌曲到歌单时如果选择`创建新歌单`并输入歌单名称后确认，应用会提示`创建歌单失败，请稍后重试。`，但实际歌单已经成功创建，歌曲也无法被实际加入这个新创建的歌单中。但如果这时再次激活该歌曲的`添加到歌单`入口，歌单选择列表就会出现上次创建失败的歌单（因为实际以创建成功），且能正常添加（添加到已创建的歌单逻辑没有问题）。该问题在多次测试中均能稳定复现，且仅在创建新歌单时出现，添加到已有歌单时不会出现该问题。
- 除了`喜欢的音乐`歌单外，一切歌单、歌手和专辑的歌曲总数都始终为 0 ，其数据获取逻辑需要修复。如果发现某些总数获取逻辑找不到,则将总数标签隐藏。类似的，对`未知歌手`和`未知专辑`这类返回空数据/占位符的情况，也同样直接隐藏标签即可。
- 播放次序选择`单曲循环`，歌曲并未按预期播放完后直接重头播放，而是会继续播放队列下一首。
- 主页入口的某些总数显示偶尔归零，如云盘的歌曲总数和已用容量在从其他页面返回到主页时，且某些入口缺少总数标签显示。
- 偶尔长时间不操作窗口后，左/右光标（快退/快进）快捷键可能会失效，使用 F12 跳转一次时间之后就会恢复正常。
- 歌手>所有歌曲的分页浏览从第二页开始应在列表结尾`下一页`之前设置`上一页`列表项，和搜索结果列表的分页显示一致，且可以调整每页显示歌曲数到 100 首，目前每页 50 首太少且和搜索结果列表的分页逻辑不一致。
- 某些情况下，程序卡在`播放已取消`状态，新的请求被之前失败的请求卡住，程序不能继续重新请求播放数据。这样的操作积累到一定程度后， UI 直接卡死进入未响应状态。详见 debug 程序运行日志["D:\GitHub\YTPlayer\bin\Debug\Logs\Debug_20251105_062901.log]。
- 某些数据/操作在不同情况掉用了不同 API 请求，导致行为不一致性。我需要你统一这些 API 请求，让行为更加统一，目前主要是分享与总数获取相关操作容易出现这类问题，在不破坏功能和业务逻辑的前提下移除旧的冗余代码，增强应用稳定性。